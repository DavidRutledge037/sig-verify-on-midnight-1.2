"use strict";(self["webpackChunk_lace_browser_extension_wallet"]=self["webpackChunk_lace_browser_extension_wallet"]||[]).push([[904],{52831:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"6f67e09126f1f0f636629f6d8be36aea.svg"},92374:(e,t,a)=>{a.d(t,{gZ:()=>l.gZ});var n=a(2784);var r=a(13819);var o=a(14970);var l=a(28005)},90653:(e,t,a)=>{a.d(t,{l:()=>UnlockWallet});var n=a(2784);var r=a(13819);var o=a(52831);var l=a(41127);var s=a(37992);var c=a(76699);var i=a(54954);const UnlockWallet=({onUnlock:e,onForgotPasswordClick:t,passwordInput:a,unlockButtonDisabled:d,showForgotPassword:u=true})=>{const{t:v}=(0,c.$)();return n.createElement(r.Dv,null,n.createElement("form",{onSubmit:e,className:s.Z.lockWalletContent},n.createElement("div",{className:s.Z.content,"data-testid":"unlock-screen"},n.createElement("img",{src:o.Z,alt:"LACE",className:s.Z.image,"data-testid":"unlock-screen-img"}),n.createElement("h1",{className:s.Z.title,"data-testid":"unlock-screen-title"},v("unlock.sectionTitle")),n.createElement(l.Password,{errorMessage:v("general.errors.invalidPassword"),error:a.invalidPass,value:a.value,onChange:a.handleChange,onPressEnter:t=>{t.preventDefault();e()},label:v("unlock.input.placeholder")})),n.createElement("div",{className:s.Z.blockButton},n.createElement(l.Button,{color:"gradient",onClick:e,disabled:d,"data-testid":"unlock-button"},v("unlock.button"))),u&&n.createElement(i.o,{onForgotPasswordClick:t})))}},96973:(e,t,a)=>{a.d(t,{B:()=>useWalletManager});var n=a(2784);var r=a(28879);var o=a.n(r);var l=a(18149);var s=a.n(l);var c=a(83134);var i=a(45827);var d=a(91817);var u=a(80615);var v=a(11939);var w=a(54966);var m=a(62410);var g=a(58718);var b=a(27399);var S=a(24296);var k=a(63791);var y=a(48834)["Buffer"];const{AVAILABLE_CHAINS:C,CHAIN:A}=(0,g.v)();const connectHardwareWallet=async e=>await c.Wallet.connectDevice(e);const encryptKeyAgents=({keyAgentsByChain:e,password:t})=>c.Wallet.KeyManagement.emip3encrypt(y.from(JSON.stringify(e)),y.from(t));const useWalletManager=()=>{const e=(0,d.$)();const{walletLock:t,setWalletLock:a,keyAgentData:r,setKeyAgentData:l,setCardanoWallet:g,resetWalletLock:E,setCurrentChain:f,setCardanoCoin:h,environmentName:p,walletManagerUi:T,cardanoWallet:x,setAddressesDiscoveryCompleted:I}=(0,i.X$)();const[W,_]=(0,u.jL)();const{utils:{clearTable:M}}=(0,w.y_)([],w.uL);const{utils:{clearTable:D}}=(0,w.y_)([],w.r4);const R=(0,v.M)();const N=(0,S.V)();const B=(0,n.useCallback)(async(e,t)=>{const a=await c.Wallet.KeyManagement.emip3encrypt(y.from(c.Wallet.KeyManagement.util.joinMnemonicWords(e)),y.from(t));await R.setBackgroundStorage({mnemonic:JSON.stringify(a)})},[R]);const F=(0,n.useCallback)(async()=>R.getWalletPassword(),[R]);const Z=(0,n.useCallback)(async(e,t,a=true)=>{try{R.setWalletPassword(y.from(e));return await t()}finally{if(a)R.setWalletPassword()}},[R]);const O=(0,n.useCallback)(async()=>{if(!t)return;await R.clearBackgroundStorage(["keyAgentsByChain"]);(0,m.Rv)("keyAgentData");l();g();I(false)},[t,R,l,g,I]);const K=(0,n.useCallback)(async e=>{if(!t)return;const a=await c.Wallet.KeyManagement.emip3decrypt(t,y.from(e));return JSON.parse(a.toString())},[t]);const P=(0,n.useCallback)(async t=>{var a;if(!r)return;const n=null===(a=(0,b.i)())||void 0===a?void 0:a.name;if(!n||!T)return;const o=await e.restoreWallet(T,n,r,F,p,void 0,t);g(o)},[r,e,T,F,p,g]);const H=(0,n.useCallback)(async({mnemonic:t,name:a,password:n,chainId:r})=>{const{keyAgentsByChain:o,...l}=await Z(n,()=>e.createCardanoWallet(T,a,t,F,r));const s=await encryptKeyAgents({keyAgentsByChain:o,password:n});await B(t,n);await R.setBackgroundStorage({keyAgentsByChain:o});(0,m.jW)({key:"lock",value:s});(0,m.jW)({key:"wallet",value:{name:a}});(0,m.jW)({key:"keyAgentData",value:l.keyAgent.serializableData});return{wallet:l,encryptedKeyAgents:s,name:a}},[R,T,Z,B,F,e]);const L=(0,n.useCallback)(async({walletInstance:e,mnemonicVerificationFrequency:t="",chainName:n=A})=>{_({chainName:n,mnemonicVerificationFrequency:t,lastMnemonicVerification:o()().valueOf().toString()});a(e.encryptedKeyAgents);g(e.wallet);l(e.wallet.keyAgent.serializableData);f(n)},[_,a,g,l,f]);const V=(0,n.useCallback)(async({accountIndex:t=0,deviceConnection:a,name:n,chainId:r,connectedDevice:o})=>e.createHardwareWallet(T,{accountIndex:t,deviceConnection:a,name:n,activeChainId:r,connectedDevice:o}),[T,e]);const X=(0,n.useCallback)(async(e,t=A)=>{const{keyAgentsByChain:n,...r}=e;await R.setBackgroundStorage({keyAgentsByChain:n});(0,m.jW)({key:"wallet",value:{name:r.name}});(0,m.jW)({key:"keyAgentData",value:r.keyAgent.serializableData});_({chainName:t,mnemonicVerificationFrequency:""});a(null);g(r);l(r.keyAgent.serializableData);f(t)},[R,_,a,g,l,f]);const $=(0,n.useCallback)(async(e=false)=>{await c.Wallet.shutdownWallet(T);(0,m.Rv)("appSettings");(0,m.Rv)("showDappBetaModal");(0,m.Rv)("lastStaking");(0,m.Rv)("userInfo");(0,m.Rv)("keyAgentData");await R.clearBackgroundStorage(["message","mnemonic","keyAgentsByChain"]);l();E();g();f(A);if(!e){(0,m.Rv)("wallet");(0,m.Rv)(k.SH);await N.clearId();M();D()}},[T,R,N,M,D,l,E,g,f]);const j=(0,n.useCallback)(async e=>{var t;if(!T)return;const a=c.Wallet.Cardano.ChainIds[e];console.info("Switching chain to",e,C);if(!a||!C.includes(e))throw new Error("Chain not supported");const n=await R.getBackgroundStorage();const r=n.keyAgentsByChain;const o=null===(t=(0,b.i)())||void 0===t?void 0:t.name;if(!r[e]||!o)throw new Error("Wallet data for chosen chain not found");const{keyAgentData:s}=r[e];if(!s)throw new Error("Wallet data for chosen chain is empty");const{asyncKeyAgent:i,keyAgent:d,wallet:u}=await c.Wallet.restoreWalletFromKeyAgent(T,o,s,F,e,false);await c.Wallet.switchKeyAgents(T,o,i,e);I(false);_({...W,chainName:e});(0,m.jW)({key:"wallet",value:{name:o}});(0,m.jW)({key:"keyAgentData",value:s});g({asyncKeyAgent:i,keyAgent:d,name:o,wallet:u});f(e);h(a);l(s)},[R,T,F,I,_,W,g,f,h,l]);const U=(0,n.useCallback)(async({addresses:e,currentChainName:t})=>{const a=c.Wallet.Cardano.ChainIds[t];const n=(0,m.Fz)("keyAgentData");if(!n)return;const r=s()(n.chainId,a);const o=e.every(e=>e.networkId===n.chainId.networkId);const i=r&&o;const d=s()(n.knownAddresses,e);if(!i)return;if(d){I(true);return}let u;if(i){u={...n,knownAddresses:e};(0,m.jW)({key:"keyAgentData",value:u})}const v=await R.getBackgroundStorage();const{name:w}=(0,m.Fz)("wallet");if(!v)throw new Error("Couldn't access background storage");const{keyAgentsByChain:b}=v;null!=u||(u={...b[t].keyAgentData,knownAddresses:e});b[t].keyAgentData=u;await R.setBackgroundStorage({keyAgentsByChain:b});const S=await c.Wallet.createKeyAgent(T,u,F);g({asyncKeyAgent:null==x?void 0:x.asyncKeyAgent,keyAgent:S,name:w,wallet:T.wallet});l(u);I(true)},[R,null==x?void 0:x.asyncKeyAgent,F,I,g,l,T]);return{lockWallet:O,unlockWallet:K,loadWallet:P,createWallet:H,setWallet:L,getPassword:F,createHardwareWallet:V,connectHardwareWallet,saveHardwareWallet:X,deleteWallet:$,executeWithPassword:Z,switchNetwork:j,updateAddresses:U}}},80615:(e,t,a)=>{a.d(t,{bW:()=>n.bW,jL:()=>n.jL});var n=a(15888)},91817:(e,t,a)=>{a.d(t,{$:()=>n.$,N:()=>n.N});var n=a(70114)},10936:(e,t,a)=>{a.d(t,{x:()=>n.x,y:()=>n.y});var n=a(37299)},51860:(e,t,a)=>{var n=a(2784);var r=a(27101);var o=a(41127);var l=a(46062);var s=a.n(l);var c=a(44036);var i=a.n(c);var d=a(96793);var u=a.n(d);var v=a(17892);var w=a.n(v);var m=a(11173);var g=a.n(m);var b=a(42464);var S=a.n(b);var k=a(18710);var y={};y.styleTagTransform=S();y.setAttributes=w();y.insert=u().bind(null,"head");y.domAPI=i();y.insertStyleElement=g();var C=s()(k.Z,y);k.Z&&k.Z.locals&&k.Z.locals;var A=a(61080);var E=a(38487);var f=a(71275);var h=a(74152);var p=a(45827);var T=a(13819);var x=a(86087);var I=a(14696);var W=a(91248);var _=a(62554);var M=a(8119);var D=a(11939);var R=a(98125);var N=a(31848);var B={};B.styleTagTransform=S();B.setAttributes=w();B.insert=u().bind(null,"head");B.domAPI=i();B.insertStyleElement=g();var F=s()(N.Z,B);N.Z&&N.Z.locals&&N.Z.locals;var Z=a(43878);var O=a(77491);var K=a(11905);var P=a(92374);var H=a(83134);var L=a(80615);var V=a(51081);var X=a(96973);var $=a(28879);var j=a.n($);var U=a(64989);var z=a.n(U);var G=a(63655);var J=a(62410);var Q=a(69082);j().extend(z())},87575:(e,t,a)=>{a.d(t,{R:()=>WarningModal});var n=a(2784);var r=a(46755);var o=a(41127);var l=a(46062);var s=a.n(l);var c=a(44036);var i=a.n(c);var d=a(96793);var u=a.n(d);var v=a(17892);var w=a.n(v);var m=a(11173);var g=a.n(m);var b=a(42464);var S=a.n(b);var k=a(92649);var y={};y.styleTagTransform=S();y.setAttributes=w();y.insert=u().bind(null,"head");y.domAPI=i();y.insertStyleElement=g();var C=s()(k.Z,y);const A=k.Z&&k.Z.locals?k.Z.locals:void 0;var E=a(76699);const f=480;const h=264;const WarningModal=({header:e,content:t,visible:a,onCancel:l,onConfirm:s,cancelLabel:c,confirmLabel:i,confirmCustomClassName:d,isPopupView:u,withCancel:v=true})=>{const{t:w}=(0,E.$)();const m=[w("general.warnings.youHaveToStartAgain")];const g=m.includes(String(e));return n.createElement(r.Z,{bodyStyle:{height:u||!g?"100%":h},centered:true,className:A.modal,onCancel:l,footer:null,visible:a,width:u?"100%":f,zIndex:1e4},n.createElement("div",{"data-testid":"delete-address-modal-title",className:A.header},e),n.createElement("div",{"data-testid":"delete-address-modal-description",className:A.content},t),n.createElement("div",{className:A.footer},v&&n.createElement(o.Button,{"data-testid":"delete-address-modal-cancel",block:true,onClick:l,color:"secondary"},null!=c?c:w("general.button.cancel")),n.createElement(o.Button,{className:d,"data-testid":"delete-address-modal-confirm",block:true,onClick:s},null!=i?i:w("general.button.agree"))))}},98125:(e,t,a)=>{a.d(t,{F1:()=>HeaderNavigation,Gh:()=>HeaderTitle,vp:()=>p,w4:()=>useHandleClose});var n=a(2784);var r=a(95384);var o=a(62554);var l=a(41127);var s=a(83134);var c=a(43112);var i=a(1251);var d=a(14696);var u=a(54940);var v=a(76699);var w=a(71275);var m=a(74152);var g=a(11939);var b=a(80710);var S=a(43715);var k=a(45827);var y=a(80513);var C=a(59512);var A=a(28732);var E=a(43878);var f=a(65888);const{SendTransaction:h}=S.iv;const useHandleClose=()=>{const{walletUI:{appMode:e},getKeyAgentType:t}=(0,k.X$)();const a=e===y.fG;const[,r]=(0,i.Lx)();const o=(0,i.xJ)();const l=(0,i.I5)();const{hasOutput:d}=(0,i.WZ)();const[,v]=(0,u.yT)();const{currentSection:g,resetSection:b}=(0,i._7)();const S=(0,w.v)(m.hW.activity);const C=(0,w.v)(m.hW.assets);const A=(0,n.useMemo)(()=>t()===s.Wallet.KeyManagement.KeyAgentType.InMemory,[t]);const E=(0,n.useCallback)(()=>{o();l();b()},[o,l,b]);const f=(0,n.useCallback)(()=>{E();v()},[E,v]);const h=(0,n.useCallback)(()=>{E();C()},[E,C]);const p=(0,n.useCallback)(()=>{if(a){E();S()}else{f();S()}if(!A)window.location.reload()},[f,A,a,S,E]);const T=(0,n.useCallback)(()=>{if(d)r(true);else a?h():f()},[d,r,a,h,f]);const x=(0,n.useCallback)(()=>{if(g.currentSection===c.bx.SUCCESS_TX){a?h():f();if(!A)window.location.reload()}else T()},[g.currentSection,a,h,f,A,T]);return{onClose:x,onCloseSubmitedTransaction:p}};const p=[c.bx.SUMMARY,c.bx.ADDRESS_LIST,c.bx.ADDRESS_FORM,c.bx.CONFIRMATION,c.bx.ASSET_PICKER];const T=new Set([c.bx.ASSET_PICKER,c.bx.ADDRESS_LIST]);const x="output1";const HeaderNavigation=({isPopupView:e})=>{const{t}=(0,v.$)();const{onClose:a}=useHandleClose();const{currentSection:s,setPrevSection:u}=(0,i._7)();const{password:w,removePassword:m}=(0,i.iJ)();const k=(0,g.M)();const{setSubmitingTxState:y}=(0,i.JJ)();const A=(0,b.Os)();const[f,I]=(0,i.M$)();const{selectedTokenList:W,resetTokenList:_}=(0,i.Cm)();const{triggerPoint:M}=(0,i.Gc)();const D=(0,n.useCallback)(()=>{if(s.currentSection===c.bx.SUMMARY)A.sendEventToMatomo({action:S.wQ.CLICK_EVENT,category:S.T3.SEND_TRANSACTION,name:e?h.BACK_TX_DETAILS_POPUP:h.BACK_TX_DETAILS_BROWSER})},[s.currentSection,A,e]);const R=e?[...p,c.bx.FORM].includes(s.currentSection):p.includes(s.currentSection);const N=e&&s.currentSection===c.bx.FORM;const B=e&&s.currentSection===c.bx.ASSET_PICKER;const F=!T.has(s.currentSection);const onArrowIconClick=()=>{D();const t=e&&[c.bx.SUCCESS_TX,c.bx.FORM,c.bx.FAIL_TX,c.bx.MIDNIGHT_FORM].includes(s.currentSection);if(w){m();y({isPasswordValid:true})}if(s.currentSection===c.bx.ASSET_PICKER)I(false);if(t)a();else u()};const onCrossIconClick=()=>{if(s.currentSection===c.bx.SUCCESS_TX)A.sendEventToPostHog(S.QE.SendAllDoneXClick,{trigger_point:M});else if(s.currentSection===c.bx.FAIL_TX)A.sendEventToPostHog(S.QE.SendSomethingWentWrongXClick,{trigger_point:M});a()};const{uiOutputs:Z}=(0,d.zJ)(x);const{address:O}=(0,d.Qw)(x);const openTabExtensionSendFlow=()=>{(0,E.Ng)({tempAddress:O,tempOutputs:Z,tempSource:"popup"});k.handleOpenBrowser({section:o.hL.SEND_ADVANCED})};const K=t(W.length>0?"multipleSelection.clear":"multipleSelection.cancel");const P=W.length>0?_:()=>I(!f);return n.createElement(l.DrawerNavigation,{title:e?void 0:n.createElement("div",null,t("core.sendReceive.send")),onArrowIconClick:R?onArrowIconClick:void 0,rightActions:N?n.createElement(l.Button,{className:r.Z.customSizeBtn,color:"secondary",variant:"outlined",onClick:openTabExtensionSendFlow,"data-testid":"add-bundle-button"},t("browserView.transaction.send.drawer.addBundle")):B?n.createElement(C.H,{testId:f?W.length>0?"clear-button":"cancel-button":"select-multiple-button",label:f?K:t("multipleSelection.selectMultiple"),onClick:P,btnStyle:f?{width:"112px",minWidth:"112px"}:{width:"152px",minWidth:"152px"}}):F?n.createElement(l.NavigationButton,{icon:"cross",onClick:onCrossIconClick}):void 0})};const useGetHeaderText=()=>{const{addressToEdit:e}=(0,f.J)();return{[c.bx.FORM]:{title:"browserView.transaction.send.drawer.newTransaction"},[c.bx.SUMMARY]:{title:"browserView.transaction.send.drawer.transactionSummary",subtitle:"browserView.transaction.send.drawer.breakdownOfYourTransactionCost"},[c.bx.CONFIRMATION]:{title:"browserView.transaction.send.confirmationTitle",subtitle:"browserView.transaction.send.signTransactionWithPassword"},[c.bx.SUCCESS_TX]:{title:""},[c.bx.FAIL_TX]:{title:""},[c.bx.ADDRESS_LIST]:{title:"browserView.transaction.send.drawer.addressBook"},[c.bx.ADDRESS_FORM]:{title:"browserView.transaction.send.drawer.addressForm"},[c.bx.ASSET_PICKER]:{title:"core.coinInputSelection.assetSelection"},[c.bx.ADDRESS_CHANGE]:{title:"addressBook.reviewModal.title",name:e.name},[c.bx.MIDNIGHT_FORM]:{title:"browserView.transaction.send.drawer.newTransaction"}}};const HeaderTitle=({popup:e,titleSlot:t})=>{var a;const{t:o}=(0,v.$)();const{currentSection:s}=(0,i._7)();const[d,u]=(0,i.M$)();const{selectedTokenList:w,resetTokenList:m}=(0,i.Cm)();const g=useGetHeaderText();const b=![c.bx.FORM,c.bx.FAIL_TX,c.bx.MIDNIGHT_FORM].includes(s.currentSection);const S=b?o(g[s.currentSection].title,{name:g[s.currentSection].name}):void 0;const k=(null===(a=g[s.currentSection])||void 0===a?void 0:a.subtitle)?o(g[s.currentSection].subtitle):void 0;const y=o(w.length>0?"multipleSelection.clear":"multipleSelection.cancel");const E=w.length>0?m:()=>u(!d);const f=e?w.length>0?n.createElement(A.l,{count:w.length}):null:n.createElement(C.H,{testId:d?w.length>0?"clear-button":"cancel-button":"select-multiple-button",count:w.length>0?w.length:void 0,label:d?y:o("multipleSelection.selectMultiple"),onClick:E,btnStyle:d?{width:"112px"}:{width:"152px"}});return b&&n.createElement(l.DrawerHeader,{popupView:e,title:n.createElement("div",{className:r.Z.header},n.createElement("div",{className:r.Z.title},S),t,s.currentSection===c.bx.ASSET_PICKER&&f),subtitle:k})}},91248:(e,t,a)=>{a.d(t,{$_:()=>r.$,F1:()=>n.F1,vp:()=>n.vp,w4:()=>n.w4});var n=a(70129);var r=a(52886)}}]);